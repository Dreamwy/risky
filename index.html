<!DOCTYPE html>
<html>
	<head>
	
	<link rel="icon shortcut" href=img/logo.png type=image/png>
    <link rel=apple-touch-icon href=img/logo.png>
    <link rel=stylesheet href=lib/bootstrap-4.0.0-dist/css/bootstrap.min.css>
    <link rel=stylesheet href=css/base.css>
    <link rel=stylesheet href=css/ui-block.css>
    
	
	<script src="js/phaser.min.js"></script>
     <script src = "js/game.js"></script>

	</head>
    <!--
    <style type="text/css">
        body{
            background: #102633;
            padding:0px;
            margin:0px;
        }
    </style>-->
	<body>

	<div class="container select-wallet-file"></div>
	<!--
     <script>
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

       ga('create', 'UA-475707-12', 'auto');
       ga('send', 'pageview');
     </script>
     -->
     <!--<script src="./js/angular.min.js"/>-->
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<!--<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>-->
<!--&lt;!&ndash; 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 &ndash;&gt;-->
<!--<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>-->
    <script src=lib/jquery-3.3.1.min.js></script>
    <script src=lib/bootstrap-4.0.0-dist/js/bootstrap.bundle.min.js data-depends=jquery.slim></script>
    <script src=lib/bootbox.min.js data-depends="bootstrap jquery.slim"></script>
    <script src=lib/blockies.min.js></script>
    <script src=lib/js-beautify-1.7.5/beautify.js></script>
    <script src=lib/prismjs-1.13.0/prism.js></script>
    <script src=lib/nebulas.js></script>
    <script src=js/1-localSave.js></script>
    <script src=js/home.v1.js></script>
    <script src=js/i18n.js data-depends=jquery.slim></script>
    <script src=js/ui-block.js data-depends="bootbox blockies jquery.slim i18n.js nebulas.js"></script>
    <script src=lib/codemirror/codemirror.js></script>
    <script src=lib/codemirror/javascript.js></script>
     <script>
        "use strict";

        var nebulas = require("nebulas"),
            Account = nebulas.Account,
            Neb = nebulas.Neb,
            Transaction = nebulas.Transaction,
            Utils = nebulas.Utils,
            neb = new Neb(),
            gAccount, gFileJson;

        neb.setRequest(new nebulas.HttpRequest("https://testnet.nebulas.io"));
        $("#keystore").on("click", onClickKeystore);
        $("#togglePassword").on("change", onChangeTogglePassword);
        
        uiBlock.insert({
            footer: ".footer",
            header: ".header",
            logoMain: ".logo-main",
            selectWalletFile: [".select-wallet-file", onUnlockFile]
        });

        function onUnlockFile(swf, fileJson, account, password) {
            try {
                
                initHeyue(account,nebulas);
                gAccount = account;
                gFileJson = fileJson;
                account.fromKey(fileJson, password);
                console.log(account.getAddressString())
                // $("#address").val(account.getAddressString());
                // $("#sideaddress").text(account.getAddressString());
                // $("#password").val(account.getPrivateKeyString());
                // $("#addressqr").html('').qrcode(account.getAddressString());
                // $("#privateqr").html('').qrcode(account.getPrivateKeyString());
                // $("#walletinfo").show();

                neb.api.getAccountState(account.getAddressString())
                    .then(function (resp) {
                        if (resp.error) {
                            throw new Error(resp.error);
                        } else {
                            console.log(nebulas.Unit.fromBasic(Utils.toBigNumber(resp.balance), "nas").toNumber() + " NAS")
                            // $("#amount").val(nebulas.Unit.fromBasic(Utils.toBigNumber(resp.balance), "nas").toNumber() + " NAS");
                        }
                    })
                    .catch(function (e) {
                        // this catches e thrown by nebulas.js!neb

                        bootbox.dialog({
                            backdrop: true,
                            onEscape: true,
                            message: i18n.apiErrorToText(e.message),
                            size: "large",
                            title: "Error"
                        });
                    });
            } catch (e) {
                // this catches e thrown by nebulas.js!account

                bootbox.dialog({
                    backdrop: true,
                    onEscape: true,
                    message: localSave.getItem("lang") == "en" ? e : "keystore 文件错误, 或者密码错误",
                    size: "large",
                    title: "Error"
                });
            }
        }

        function onClickKeystore() {
            var blob = new Blob([JSON.stringify(gFileJson)], { type: "application/json; charset=utf-8" });
            saveAs(blob, gAccount.getAddressString());
        }

        function onChangeTogglePassword(e) {
            if (e.target.checked) {
                $("#password").prop("type", "text");
                $(".key_qr").removeClass("display-none");
            } else {
                $("#password").prop("type", "password");
                $(".key_qr").addClass("display-none");
            }
        }
    </script>
	</body>
</html>
